# 教培管家系统 - 需求规格说明书 (v1.0)

## 1. 文档概述

本文档旨在定义“教培管家”管理后台的核心功能需求。系统主要服务于中大型教培机构，通过精细化的 **RBAC 权限控制**，实现跨校区、跨职能的高效协同管理。

## 2. 业务角色定义

| 角色 | 描述 | 核心关注点 |
| --- | --- | --- |
| **集团校长/管理员** | 拥有最高权限，管理整个机构的架构。 | 统计全校区数据、分配高级权限。 |
| **分校校长** | 管理特定校区的日常事务。 | 本校区人员动态、本校区业务数据。 |
| **教务/销售主管** | 带领特定部门。 | 部门内部成员的任务分配与审核。 |
| **普通员工/老师** | 执行具体业务。 | 个人工作台、自己负责的学员信息。 |

---

## 3. 核心功能模块

### 3.1 组织架构管理 (Organization)

* **多层级管理**：支持“集团 - 区域中心 - 校区 - 部门”的树形组织架构。
* **节点属性**：每个节点可配置负责人、联系电话、地理位置等。
* **灵活调整**：支持部门的平移或上下级关系变更。

### 3.2 人员账号管理 (Staffing)

* **账号生命周期**：支持员工入职（新增）、信息变更、离职（禁用/删除）。
* **多角色绑定**：一个员工可以同时拥有多个角色（如：某分校校长兼任金牌讲师）。
* **快速搜索**：支持按姓名、手机号、所属校区实时筛选。

### 3.3 角色权限配置 (RBAC)

* **功能权限**：通过勾选菜单树，控制用户能看到的页面和能点击的按钮（增/删/改/查/导出）。
* **数据权限（核心需求）**：
* **全部权限**：总部财务/校长可见全系统数据。
* **本部门及以下**：校区负责人可见本校区所有部门数据。
* **仅本人**：销售顾问仅能看到自己跟进的学员。



### 3.4 动态菜单管理 (System Menu)

* **导航配置**：支持自定义菜单图标、显示顺序。
* **权限标识**：为每个按钮分配唯一的 `perms` 字符串（如 `stu:add`），供前后端鉴权使用。

---

## 4. 权限逻辑需求 (Logic Specification)

### 4.1 功能权限 (Functional Permissions)

系统需实现“所见即所得”的权限控制：

1. **路由拦截**：用户尝试通过直接输入 URL 访问无权页面时，系统应重定向至 403 页面。
2. **UI 隐藏**：若用户无 `system:user:add` 权限，页面上的“新增人员”按钮应不予渲染。

### 4.2 数据权限 (Data Scoping)

数据过滤必须在 **服务端 (Server Side)** 完成。系统需根据当前用户的 `data_scope` 自动在数据库查询语句中追加 `WHERE` 条件。

* *场景：* 当一名老师登录后，其学员列表接口应自动过滤为 `WHERE teacher_id = current_user_id`。

---

## 5. 交互与非功能需求

### 5.1 界面交互 (UI/UX)

* **响应式布局**：基于 shadcn/ui，确保在平板电脑（校长巡店时使用）和 PC 端均有良好体验。
* **流式加载 (Streaming)**：利用 Next.js 16 的 `Suspense`，在数据加载时展示 Skeleton 骨架屏，减少用户焦虑。
* **反馈机制**：所有的“增删改”操作完成后，必须弹出 Toast 提示（成功/失败）。

### 5.2 安全性

* **密码安全**：数据库禁止明文存储，需使用 `bcrypt` 进行哈希加密。
* **会话管理**：使用 `NextAuth.js` 或类似方案实现安全的 Session/JWT 管理。

---

## 6. 项目演进计划 (Roadmap)

1. **第一阶段 (MVP)**：完成组织架构、人员管理、角色权限的核心流程，实现基础 RBAC。
2. **第二阶段 (Business)**：接入学员报名、排课管理、考勤统计。
3. **第三阶段 (Analytics)**：实现跨校区营收报表、大数据看板。

---

**给开发者的建议：**
既然你准备使用 Next.js 16，我建议在处理“数据权限”时，利用 **React Server Components (RSC)** 在服务端直接注入用户信息。
