# 教培管家系统 - 数据库设计文档 (v1.0)

## 1. 设计概述

本系统采用增强型 **RBAC (Role-Based Access Control)** 模型。

* **功能权限**：通过“用户-角色-菜单”实现页面可见性及操作按钮的控制。
* **数据权限**：通过角色的 `data_scope` 属性，结合 SQL 拦截实现“看谁的数据”的逻辑。
* **组织架构**：支持无限层级的树形结构，兼容“集团-校区-部门”模式。

## 2. 命名规范

* **表名**：使用小写蛇形命名法（snake_case），统一前缀 `sys_`。
* **主键**：统一使用 `bigint` 类型的 `id`，建议使用分布式 ID（如 Snowflake）或自增 ID。
* **公共字段**：包含 `create_time`, `update_time`, `create_by`, `update_by`, `del_flag`。

---

## 3. 表结构详解

### 3.1 组织机构表 (`sys_dept`)

用于管理机构、校区及部门。

| 字段名 | 类型 | 长度 | 必填 | 备注 |
| --- | --- | --- | --- | --- |
| dept_id | bigint | 20 | 是 | 主键ID |
| parent_id | bigint | 20 | 是 | 父部门ID (顶级为0) |
| ancestors | varchar | 50 | 否 | 祖级列表 (例如: 0,100,101) |
| dept_name | varchar | 30 | 是 | 部门/校区名称 |
| order_num | int | 4 | 否 | 显示顺序 |
| leader | varchar | 20 | 否 | 负责人姓名 |
| phone | varchar | 11 | 否 | 联系电话 |
| status | char | 1 | 是 | 状态 (0正常, 1停用) |
| del_flag | char | 1 | 是 | 删除标志 (0存在, 2删除) |

### 3.2 用户信息表 (`sys_user`)

存储教职工基本信息。

| 字段名 | 类型 | 长度 | 必填 | 备注 |
| --- | --- | --- | --- | --- |
| user_id | bigint | 20 | 是 | 主键ID |
| dept_id | bigint | 20 | 是 | 归属部门/校区ID |
| user_name | varchar | 30 | 是 | 用户登录账号 |
| nick_name | varchar | 30 | 是 | 用户昵称/真实姓名 |
| password | varchar | 100 | 是 | 加密后的密码 |
| phonenumber | varchar | 11 | 否 | 手机号码 |
| status | char | 1 | 是 | 状态 (0正常, 1停用) |
| create_time | datetime | - | 否 | 创建时间 |

### 3.3 角色信息表 (`sys_role`)

核心权限定义表。

| 字段名 | 类型 | 长度 | 必填 | 备注 |
| --- | --- | --- | --- | --- |
| role_id | bigint | 20 | 是 | 主键ID |
| role_name | varchar | 30 | 是 | 角色名称 (如：销售主管) |
| role_key | varchar | 100 | 是 | 权限字符 (如：sales_mgr) |
| data_scope | char | 1 | 是 | **数据范围** (见下文说明) |
| status | char | 1 | 是 | 状态 (0正常, 1停用) |

### 3.4 菜单权限表 (`sys_menu`)

存储目录、菜单及按钮。

| 字段名 | 类型 | 长度 | 必填 | 备注 |
| --- | --- | --- | --- | --- |
| menu_id | bigint | 20 | 是 | 主键ID |
| menu_name | varchar | 50 | 是 | 菜单名称 |
| parent_id | bigint | 20 | 是 | 父菜单ID |
| menu_type | char | 1 | 是 | 类型 (M目录, C菜单, F按钮) |
| perms | varchar | 100 | 否 | 权限标识 (如 system:user:add) |
| path | varchar | 200 | 否 | 路由地址 |
| component | varchar | 255 | 否 | 组件路径 |

### 3.5 关联表

* **用户-角色关联表 (`sys_user_role`)**: `user_id`, `role_id`
* **角色-菜单关联表 (`sys_role_menu`)**: `role_id`, `menu_id`
* **角色-部门关联表 (`sys_role_dept`)**: `role_id`, `dept_id` (仅用于“自定义数据权限”模式)

---

## 4. 权限逻辑说明

### 4.1 数据权限类型 (`data_scope`)

字段值定义如下：

* `1`：**全部数据权限**。可以查看系统内所有校区的数据。
* `2`：**自定义数据权限**。关联 `sys_role_dept` 表，可跨部门选择多个校区。
* `3`：**本部门数据权限**。仅限查看所属部门/校区的数据。
* `4`：**本部门及以下数据权限**。查看所属校区及下属所有部门的数据。
* `5`：**仅本人数据权限**。只能查看自己录入或负责的数据。

### 4.2 按钮级控制实现

前端获取用户拥有的 `perms` 集合（如 `['system:user:add', 'system:user:edit']`）。

* 在 Next.js 组件中：
```tsx
{permissions.includes('system:user:add') && <Button>新增用户</Button>}

```



---

## 5. 索引优化建议

1. `sys_user.user_name`：唯一索引。
2. `sys_dept.parent_id`：普通索引，加速树形结构查询。
3. 关联表的主键：建议使用复合主键，如 `PRIMARY KEY (user_id, role_id)`。

---