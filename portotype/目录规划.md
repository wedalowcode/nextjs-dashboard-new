### 核心规划思路

1. **路由结构 (`app/dashboard/...`)**：将系统管理放在 `dashboard` 下，利用 `layout.tsx` 实现侧边栏和顶部导航的持久化。
2. **数据层 (`app/lib/...`)**：严格区分 **类型定义 (`definitions.ts`)**、**数据查询 (`data.ts`)** 和 **数据变更 (`actions.ts`)**。
3. **UI 组件 (`app/ui/...`)**：按照业务模块拆分组件，表格、搜索框、弹窗表单都放在这里。

---

### 目录结构树

```text
/
├── app/
│   ├── lib/                       # 【数据核心层】
│   │   ├── actions.ts             # Server Actions (增删改逻辑)
│   │   ├── data.ts                # 数据查询函数 (查数据库)
│   │   ├── definitions.ts         # TypeScript 类型定义 (对应 DB 表结构)
│   │   ├── placeholder-data.ts    # 开发阶段的假数据
│   │   └── utils.ts               # 通用工具 (格式化日期、金额等)
│   │
│   ├── ui/                        # 【UI 组件层】
│   │   ├── global.css             # 全局样式
│   │   ├── dashboard/             # 仪表盘公共组件
│   │   │   ├── nav-links.tsx      # 侧边栏导航
│   │   │   ├── sidenav.tsx        # 侧边栏容器
│   │   │   └── cards.tsx          # 概览卡片
│   │   │
│   │   └── system/                # 【系统管理模块组件】(对应你的5个需求)
│   │       ├── dept/              # 1. 机构/部门组件
│   │       │   ├── table.tsx      # 树形表格
│   │       │   └── create-form.tsx
│   │       ├── user/              # 2. 人员管理组件
│   │       │   ├── table.tsx
│   │       │   ├── buttons.tsx    # 操作按钮 (编辑/删除)
│   │       │   └── create-form.tsx
│   │       ├── role/              # 3. 角色 & 6. 数据权限组件
│   │       │   ├── table.tsx
│   │       │   └── permission-tree.tsx # 权限树勾选组件
│   │       └── menu/              # 4. 菜单管理组件
│   │           └── table.tsx
│   │
│   ├── dashboard/                 # 【页面路由层】
│   │   ├── layout.tsx             # 仪表盘主布局 (包含 SideNav)
│   │   ├── page.tsx               # 仪表盘首页 (统计数据)
│   │   │
│   │   └── system/                # 系统管理路由组
│   │       ├── dept/
│   │       │   └── page.tsx       # /dashboard/system/dept
│   │       ├── user/
│   │       │   ├── page.tsx       # /dashboard/system/user (列表页)
│   │       │   ├── create/
│   │       │   │   └── page.tsx   # /dashboard/system/user/create (新增页)
│   │       │   └── [id]/
│   │       │       └── edit/
│   │       │           └── page.tsx # /dashboard/system/user/[id]/edit (编辑页)
│   │       ├── role/
│   │       │   └── page.tsx       # /dashboard/system/role
│   │       └── menu/
│   │           └── page.tsx       # /dashboard/system/menu
│   │
│   ├── login/                     # 登录页
│   │   └── page.tsx
│   └── layout.tsx                 # 根布局
│
├── auth.config.ts                 # NextAuth 配置 (中间件逻辑)
├── auth.ts                        # NextAuth 初始化
├── middleware.ts                  # 路由拦截 (未登录跳转登录页)
└── next.config.ts

```

---

### 关键文件实现详解

#### 1. 类型定义 (`app/lib/definitions.ts`)

这里直接对应你刚才设计的数据库表。

```typescript
// 对应 sys_user 表
export type User = {
  id: string; // 对应 user_id
  dept_id: string;
  name: string;
  email: string;
  role_name: string; // 关联查询出来的角色名
  status: 'active' | 'inactive'; // 对应 status 0/1
};

// 对应 sys_dept 表
export type Dept = {
  id: string;
  parent_id: string;
  name: string;
  children?: Dept[]; // 用于前端构建树形结构
};

```

#### 2. 页面实现 (`app/dashboard/system/user/page.tsx`)

Next.js 16 推荐在 Page 层直接获取数据（Server Component），然后传给 UI 组件。

```tsx
import Search from '@/app/ui/search';
import Table from '@/app/ui/system/user/table';
import { CreateUserBtn } from '@/app/ui/system/user/buttons';
import { fetchUsersPages } from '@/app/lib/data';

export default async function Page({
  searchParams,
}: {
  searchParams?: {
    query?: string;
    page?: string;
  };
}) {
  const query = searchParams?.query || '';
  const currentPage = Number(searchParams?.page) || 1;
  
  // 这里获取总页数，用于分页组件
  const totalPages = await fetchUsersPages(query);

  return (
    <div className="w-full">
      <div className="flex w-full items-center justify-between">
        <h1 className="text-2xl">人员管理</h1>
      </div>
      <div className="mt-4 flex items-center justify-between gap-2 md:mt-8">
        <Search placeholder="搜索姓名或手机号..." />
        <CreateUserBtn />
      </div>
       {/* Suspense 实现流式加载，数据加载时显示骨架屏 */}
      <Suspense key={query + currentPage} fallback={<UsersTableSkeleton />}>
        <Table query={query} currentPage={currentPage} />
      </Suspense>
    </div>
  );
}

```

#### 3. 数据操作 (`app/lib/actions.ts`)

对应你的“增删改”操作，使用 Server Actions。

```typescript
'use server';

import { z } from 'zod';
import { sql } from '@vercel/postgres'; // 或者你的数据库连接库
import { revalidatePath } from 'next/cache';
import { redirect } from 'next/navigation';

// 定义验证 Schema
const CreateUser = z.object({
  deptId: z.string(),
  name: z.string(),
  email: z.string().email(),
  // ... 其他字段
});

export async function createUser(prevState: State, formData: FormData) {
  // 1. 校验数据
  const validatedFields = CreateUser.safeParse({
    deptId: formData.get('deptId'),
    name: formData.get('name'),
    // ...
  });

  // 2. 插入数据库 (sys_user)
  // ... SQL insert ...

  // 3. 刷新缓存并跳转
  revalidatePath('/dashboard/system/user');
  redirect('/dashboard/system/user');
}

```

### 针对你教培业务的特殊建议

1. **部门树的处理 (`/system/dept`)**：
* 官方教程里主要是平铺列表，但你的 `sys_dept` 是树形结构。
* 建议在 `app/ui/system/dept/table.tsx` 中使用递归组件或第三方库（如 `react-arborist` 或 Ant Design 的 TreeTable）来展示层级。


2. **权限分配的处理 (`/system/role`)**：
* 角色管理页面的“新增/编辑”通常需要一个复杂的表单。
* 建议在 `app/ui/system/role/` 下创建一个 `permission-form.tsx`，里面包含两个核心区块：
* **菜单权限**：勾选 `sys_menu` 的树。
* **数据权限**：下拉选择 `data_scope` (全部/本部门/自定义等)。如果是“自定义”，则还要显示部门树供勾选。




3. **路由鉴权**：
* 虽然你有 `sys_menu` 表，但 Next.js 的路由是文件系统的。
* 你需要在 `middleware.ts` 或者 `layout.tsx` 中，根据当前登录用户的角色，读取 `sys_role_menu`，判断他是否有权访问 `/dashboard/system/user` 这种路径。如果没有，重定向到 403 页面。
